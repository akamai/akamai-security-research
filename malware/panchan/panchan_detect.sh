#!/usr/bin/env sh

echo "Panchan's mining rig Detection Script by Akamai Threat Labs"

persist=false
binary=false
listening_port=false

systemctl list-units --full -all | grep -q "systemd-worker.service" && {
    persist=true
    echo "[*] Panchan persistence service detected"
}

find /.* -maxdepth 1 -name xinetd -type f | grep -q "xinetd" && {
    binary=true
    echo "[*] Panchan binary path detected"
}


netstat -lno | grep -wq 1919 && {
    listening_port=true
    echo '[*] Listening on port 1919'
}

if $persist || $listening_port || $binary; then
    echo "[*] There is evidence of Panchan malicious activity on this machine."
    exit 1
else
    echo '[*] The machine seems to not be infected with Panchan'
    exit 0
fi