# Mexals detection logic and IoCs

This repository contains a detection can detect traces of the Mexals campaign.  
It looks for the malware's persistence service, paths and other relics.  
Below, you can also find OsQuery queries that detect some of the malware's artifacts.
  
The full report about Mexals can be found in our [blogpost](https://akamai.com/blog/security-research/mexals-cryptojacking-malware-resurgence).  

-----------------------
## Osquery
We're also including Osquery queries that can be run to look for malware IoCs.  

### Malware files and process
`SELECT path FROM file WHERE path = '/var/tmp/.update-logs' OR path = '/var/tmp/Documents' OR path='/var/tmp/.ladyg0g0' OR path='/dev/shm/.x' OR path='/dev/shm/.magic';`  
`SELECT name, cmdline, pid FROM processes WHERE name IN ('Chrome', 'Update', 'aliases', 'Opera', '.diicot', 'retea', 'network', 'History', 'payload');`  

### Persistence
`SELECT * FROM crontab WHERE command LIKE '/var/tmp/.update-logs/%' OR command LIKE '/var/tmp/Documents/%' OR command LIKE '/var/tmp/.ladyg0g0/%' OR command LIKE '/dev/shm/.x/%' or command LIKE '/dev/shm/.magic%';`  

### Backdoor
`SELECT * FROM authorized_keys WHERE key LIKE '%AAAAB3NzaC1yc2EAAAABJQAAAQEAoBjnno5GBoIuIYIhrJsQxF6OPHtAbOUIEFB+gdfb1tUTjs+f9zCMGkmNmH45fYVukw6IwmhTZ+AcD3eDpgsTloqmVgcXDUmvjWR/fNiImmgU9wlw/lalf/WrIuCDp0PArQtjNg/vo7HUGq9SrEIE2jvyVW59mvoYOwfnDLUiguKZirZgpjZF2DDKK6WpZVTVpKcH+HEFdmFAqJInem/CRUE0bqjMr88bUyDjVw9FtJ5EmQenctjrFVaB7hswOaJBmFQmn9G/BXkMvZ6mX7LzCUM2PVHnVfVeCLdwiOINikzW9qzlr8WoHw4qEGJLuQBWXjJu+m2+FdaOD6PL53nY3w==%' OR key LIKE '%ElPatrono1337%';`  
